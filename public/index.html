<!DOCTYPE html>
<html>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <head>
    <style>
       #map {
        height: 800px;
        width: 100%;
       }
    </style>
  </head>
  <body>
    <h3>My Google Maps Demo</h3>


<!--
    <form action="/foursquare" method="post">
      <label for="input">Enter name: </label>
      <input id="input" type="text" name="location" value="food">
      <input type="submit" value="OK">
    </form>
-->
    
	  <input id="query">
      <button type="button" onclick="queryFoursquare()">Search Places</button>
    

    <div id="map"></div>
    
    <script>  
      var dataobj = {lat: 1.1,lng: 1.1}
      var map, heatmap;
	  var query_name = document.getElementById("query").value;

      function initMap() {
		//console.log(obj.lat);
        var uluru = {lat: dataobj.lat, lng: dataobj.lng};
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          center: uluru
        });
        var marker = new google.maps.Marker({
          position: uluru,
          map: map
        });
      }

      function queryFoursquare(query) {
	    
	    var query_name = document.getElementById("query").value;

        console.log(dataobj);
        var latlng = dataobj

        /*
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          
          document.getElementById("map").innerHTML = "hello world";
          console.log("got it");
        }
        */
        $.ajax({
    type: "GET",
    dataType: "jsonp",
    cache: false,
    url: 'https://api.foursquare.com/v2/venues/explore?ll=' + latlng.lat + ',' + latlng.lng + '&limit=30&client_id=COHMOQH1IRCXSHOSCJQGCHMW0KDM15T2SL42SV4HEXZNCZ1O&client_secret=T10V523SUH04DKHMUVAUQSBECBLVCPMKHDR5BFJDHLX3I5CB&query=' + query_name + '&v=20180331',
    success: function(data){
        console.log(data);

    	var base = data.response.groups[0].items

    	$.each(base, function(index){

    		var url = base[index].venue.url;
    		var llat = base[index].venue.location.lat;
    		var llng = base[index].venue.location.lng;
    		var name = base[index].venue.name;
    		var icon = base[index].venue.categories[0].icon;
/*
    		var myIcon = L.icon({
    		    iconUrl: icon,
    		    iconSize: [20, 20],
    		    iconAnchor: [10, 10],
    		    className: '4sq-icon'
    		});

    		var marker = L.marker([llat, llng], {icon: myIcon}).addTo(map);
    		var content = '<a href="' + url + '" />' + name + '</a>'
    		marker.bindPopup(content)
*/
    	})
    }
});
      }

      $.ajax({
        type: "GET",
        url: "http://localhost:8000/latlng",
        success: function(data) {
          dataobj = data;
          console.log(data);
        }
      });
      

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC23xU5BZyTpbqTH-FaQWgUpgNGdswo-N0&callback=initMap">
    </script>
  </body>
</html>
